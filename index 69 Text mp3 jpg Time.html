<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>å…­å®â¤ä¹…ä¹…</title>
    <link rel="stylesheet" href="css/index.css" />
    <style>
        html,
        body {
            height: 100%;
            padding: 0;
            margin: 0;
            background-color: black;
            perspective: 800px;
        }

        canvas {
            position: absolute;
            width: 100%;
            height: 100%;

        }
    </style>

</head>

<body>

    <!-- æ‰“å­—æ•ˆæœ -->
    <div class="myp" id="aa">
        "â‰ä¹…ä¹…åŒå­¦ï¼Œä½ å¥½å‘€~"
        "â‰é‚£ä¸ªæ™®é€šçš„å¤œé‡Œï¼Œç›¸è·69.02å…¬é‡Œ"
        "â‰æˆ‘é‡åˆ°äº†ç‰¹åˆ«çš„ä½ "
        "â‰ä¸çŸ¥ä¸ºä½•ï¼Œæˆ–è®¸æ˜¯å› ä¸ºæœ‰ç¼˜"
        "â‰ä½ æ‰“å¼€äº†ç½‘æ˜“äº‘ï¼Œæ‰“å¼€äº†ä¸€èµ·å¬"
        "â‰æˆ‘æ‰“å¼€äº†ç½‘æ˜“äº‘ï¼Œæ‰“å¼€äº†ä¸€èµ·å¬"
        "â‰ä½ æˆ‘åŒæ—¶æˆ´ç€è€³æœº"
        "â‰å¬ç€å½¼æ­¤å–œæ¬¢çš„éŸ³ä¹"
        "â‰æˆ‘ä»¬çº¦å®šå¬æ»¡99å°æ—¶"
        "â‰å‘Šè¯‰å½¼æ­¤å­¦æ ¡çš„åå­—"
        "â‰æˆ‘ä»¬çº¦å®šç›¸è¯†99å¤©"
        "â‰æ·»åŠ å½¼æ­¤çš„è”ç³»æ–¹å¼"
        "â‰ç»†ç»†æ•°æ•°ï¼Œç°åœ¨æ˜¯æˆ‘ä»¬ç›¸è¯†çš„ç¬¬30å¤©"
        "â‰åœ¨è¿™30å¤©é‡Œï¼Œæˆ‘å‘ç°"
        "â‰æˆ‘ä»¬ä¸åªæ˜¯æœ‰å…±åŒå–œæ¬¢çš„æ­Œæ›²"
        "â‰æˆ‘ä»¬æ— è¯ä¸è¯´ï¼Œå€¾å¬å½¼æ­¤ï¼Œç›¸äº’ç†è§£"
        "â‰æˆ‘ä»¬è¿˜æ˜¯ä¸¤ä¸ªå¼€å¿ƒçš„åƒè´§ï¼Œä¹æ­¤ä¸ç–²"
        "â‰æˆ‘è¿˜å‘ç°ï¼Œä½ æœ‰ä¸€ä¸ªå–„è‰¯å¯çˆ±çš„å¿ƒçµ"
        "â‰äºæ˜¯ï¼Œæˆ‘å¼€å§‹æ¸æ¸å¿ƒåŠ¨ï¼Œç›´åˆ°ç°åœ¨"
        "â‰æœ‰äº›å¿ƒåŠ¨ï¼Œä¸€æ—¦å¼€å§‹ï¼Œä¾¿è¦†æ°´éš¾æ”¶"
        "â‰æœ‰ä¸€ç§é»˜å¥‘å«å¿ƒç…§ä¸å®£"
        "â‰æœ‰ä¸€ç§æ„Ÿè§‰å«å¦™ä¸å¯è¨€"
        "â‰æœ‰ä¸€ç§å¹¸ç¦å«æœ‰ä½ ç›¸ä¼´"
        "â‰æœ‰ä¸€ç§æ€å¿µå«æœ›çœ¼æ¬²ç©¿"
        "â‰ä»Šå¤©æ˜¯ä¸ªç‰¹åˆ«çš„æ—¥å­"
        "â‰è¿™ä»½æ¥è‡ªç¨‹åºå‘˜çš„æµªæ¼«ï¼Œè¯·ä½ æ”¶ä¸‹"
        "â‰æˆ‘å¾ˆæœŸå¾…é¢åŸºé‚£ä¸€å¤©çš„åˆ°æ¥"
        "â‰èƒ½å½“é¢è¯´ä¸€å£°ï¼Œé‚£ä¸ªå¼ºç›—ï¼Œä»–æ¥äº†"
        "â‰å¸Œæœ›ä½ èƒ½ç»™è¿™ä¸ªå¼ºç›—ä¸€ä¸ªæœºä¼š~"
        "â‰Getting a crush on you!"
        "â‰ğŸŒ¹â€”â€”å…­å®ğŸŒ¹"
    </div>
    <div style="display:none" id="w">
        "â‰ä¹…ä¹…åŒå­¦ï¼Œä½ å¥½å‘€~"
        "â‰é‚£ä¸ªæ™®é€šçš„å¤œé‡Œï¼Œç›¸è·69.02å…¬é‡Œ"
        "â‰æˆ‘é‡åˆ°äº†ç‰¹åˆ«çš„ä½ "
        "â‰ä¸çŸ¥ä¸ºä½•ï¼Œæˆ–è®¸æ˜¯å› ä¸ºæœ‰ç¼˜"
        "â‰ä½ æ‰“å¼€äº†ç½‘æ˜“äº‘ï¼Œæ‰“å¼€äº†ä¸€èµ·å¬"
        "â‰æˆ‘æ‰“å¼€äº†ç½‘æ˜“äº‘ï¼Œæ‰“å¼€äº†ä¸€èµ·å¬"
        "â‰ä½ æˆ‘åŒæ—¶æˆ´ç€è€³æœº"
        "â‰å¬ç€å½¼æ­¤å–œæ¬¢çš„éŸ³ä¹"
        "â‰æˆ‘ä»¬çº¦å®šå¬æ»¡99å°æ—¶"
        "â‰å‘Šè¯‰å½¼æ­¤å­¦æ ¡çš„åå­—"
        "â‰æˆ‘ä»¬çº¦å®šç›¸è¯†99å¤©"
        "â‰æ·»åŠ å½¼æ­¤çš„è”ç³»æ–¹å¼"
        "â‰ç»†ç»†æ•°æ•°ï¼Œç°åœ¨æ˜¯æˆ‘ä»¬ç›¸è¯†çš„ç¬¬30å¤©"
        "â‰åœ¨è¿™30å¤©é‡Œï¼Œæˆ‘å‘ç°"
        "â‰æˆ‘ä»¬ä¸åªæ˜¯æœ‰å…±åŒå–œæ¬¢çš„æ­Œæ›²"
        "â‰æˆ‘ä»¬æ— è¯ä¸è¯´ï¼Œå€¾å¬å½¼æ­¤ï¼Œç›¸äº’ç†è§£"
        "â‰æˆ‘ä»¬è¿˜æ˜¯ä¸¤ä¸ªå¼€å¿ƒçš„åƒè´§ï¼Œä¹æ­¤ä¸ç–²"
        "â‰æˆ‘è¿˜å‘ç°ï¼Œä½ æœ‰ä¸€ä¸ªå–„è‰¯å¯çˆ±çš„å¿ƒçµ"
        "â‰äºæ˜¯ï¼Œæˆ‘å¼€å§‹æ¸æ¸å¿ƒåŠ¨ï¼Œç›´åˆ°ç°åœ¨"
        "â‰æœ‰äº›å¿ƒåŠ¨ï¼Œä¸€æ—¦å¼€å§‹ï¼Œä¾¿è¦†æ°´éš¾æ”¶"
        "â‰æœ‰ä¸€ç§é»˜å¥‘å«å¿ƒç…§ä¸å®£"
        "â‰æœ‰ä¸€ç§æ„Ÿè§‰å«å¦™ä¸å¯è¨€"
        "â‰æœ‰ä¸€ç§å¹¸ç¦å«æœ‰ä½ ç›¸ä¼´"
        "â‰æœ‰ä¸€ç§æ€å¿µå«æœ›çœ¼æ¬²ç©¿"
        "â‰ä»Šå¤©æ˜¯ä¸ªç‰¹åˆ«çš„æ—¥å­"
        "â‰è¿™ä»½æ¥è‡ªç¨‹åºå‘˜çš„æµªæ¼«ï¼Œè¯·ä½ æ”¶ä¸‹"
        "â‰æˆ‘å¾ˆæœŸå¾…é¢åŸºé‚£ä¸€å¤©çš„åˆ°æ¥"
        "â‰èƒ½å½“é¢è¯´ä¸€å£°ï¼Œé‚£ä¸ªå¼ºç›—ï¼Œä»–æ¥äº†"
        "â‰å¸Œæœ›ä½ èƒ½ç»™è¿™ä¸ªå¼ºç›—ä¸€ä¸ªæœºä¼š~"
        "â‰Getting a crush on you!"
        "â‰ğŸŒ¹â€”â€”å…­å®ğŸŒ¹"
    </div>
    <script>
        var index = 0;
        var word = document.getElementById("w").innerHTML;
        function type() {
            document.getElementById("aa").innerText = word.substring(0, index++);
        }
        setInterval(type, 280);
    </script>
    <style type="text/css">
        #aa {
            position: absolute;

            display: flex;

            width: 350px;

            height: 700px;

            background-color: black;

            color: skyblue;

            text-shadow: 0px 0px 15px #FF6EC7, 0px 0px 15px #FF6EC7, 0px 0px 15px #FF6EC7;

            word-wrap: break-word;

            line-height: 30px;

            letter-spacing: 3px;

            padding-left: 3px;

            text-indent: 40px;

            border-radius: 5px;

            -webkit-box-shadow: 3px 3px 3px 3px rgba(0, 0, 0, 0.1);

            -moz-box-shadow: 3px 3px 3px 3px rgba(0, 0, 0, 0.1);

            box-shadow: 3px 3px 3px 3px rgba(236, 8, 8, 0.1);

        }
    </style>
    <!-- æ­£å‘è®¡æ—¶ -->
    <div class="item">
        <span id="timeDate" style="position: absolute;
        font-size: 15px;
        text-align: center;
        /* background-color: darkgray; */
        color: rgb(224, 207, 23);
        text-shadow: 0px 0px 15px #00FFFF, 0px 0px 15px #00FFFF, 0px 0px 15px #00FFFF;
        margin-left: 400px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">è½½å…¥å¤©æ•°...</span>
        <br>
        <span id="times" style="position: absolute;
        font-size: 20px;
        text-align: center;
        /* background-color: darkgray; */
        color: rgb(224, 207, 23);
        text-shadow: 0px 0px 15px #00FFFF, 0px 0px 15px #00FFFF, 0px 0px 15px #00FFFF;
        margin-left: 400px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">è½½å…¥æ—¶åˆ†ç§’...</span>
    </div>
    <script>
        var now = new Date();
        function createtime() {
            var grt = new Date("10/28/2022 23:27:00");//ä¿®æ”¹æ—¶é—´
            // var grt = new Date("10/15/2022 00:06:00");
            now.setTime(now.getTime() + 250);
            days = (now - grt) / 1000 / 60 / 60 / 24;
            dnum = Math.floor(days); hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum);
            hnum = Math.floor(hours); if (String(hnum).length == 1) { hnum = "0" + hnum; } minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum); mnum = Math.floor(minutes);
            if (String(mnum).length == 1) { mnum = "0" + mnum; } seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); snum = Math.round(seconds);
            if (String(snum).length == 1) { snum = "0" + snum; } document.getElementById("timeDate").innerHTML = "ä¹…ä¹…å’Œå…­å®å·²ç»è®¤è¯† " + dnum + " å¤©";
            document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
        } setInterval("createtime()", 250);
    </script>
    <!-- å€’å‘è®¡æ—¶ -->
    <h1 id="hh"></h1>
    <script type="text/javascript">
        function station(x, y, z) {
            //å½“å‰æ—¶é—´
            var now = Date.now(),
                //ç»“æŸæ—¶é—´
                end = new Date(x, y - 1, z),
                ends = end.getTime();
            var ss = ends - now;
            var s = Math.floor(ss / 1000);
            //ç›¸å·®å¤©æ•°
            var day = Math.floor(s / 60 / 60 / 24);
            //ç›¸å·®å°æ—¶æ•°
            var hours = Math.floor(s / 60 / 60 % 24);
            //ç›¸å·®åˆ†é’Ÿæ•°
            var min = Math.floor(s / 60 % 60);
            //ç›¸å·®ç§’æ•°
            var sec = Math.floor(s % 60);
            var html = "è·ç¦»ç¬¬99å¤©è¿˜æœ‰" + day + "å¤©" + hours + "æ—¶" + min + "åˆ†" + sec + "ç§’";
            hh.innerHTML = html;

        }
        station(2023, 02, 05);
        // station(2023, 01, 22);
        //ä¸€ç§’ä¸€æ¬¡è°ƒç”¨
        setInterval(function () {
            station(2023, 02, 05);
            // station(2023, 01, 22);
        }, 1000);
    </script>
    <style type="text/css">
        #hh {
            position: absolute;
            font-size: 30px;
            text-align: center;
            /* background-color: darkgray; */
            color: white;
            text-shadow: 0px 0px 15px #00FFFF, 0px 0px 15px #00FFFF, 0px 0px 15px #00FFFF;
            margin-left: 400px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
    <!-- éŸ³ä¹æ’­æ”¾ -->
    <audio autoplay="autoplay" loop="">
        <source src="./mp3/è¶…å–œæ¬¢ä½ .mp3">
    </audio>
    <!-- æ—‹è½¬ç›¸å†Œ -->
    <div class="wrap">
        <!--    /*ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ôªï¿½Øµï¿½ï¿½ï¿½ï¿½ï¿½*/-->
        <div class="cube">
            <!--Ç°ï¿½ï¿½Í¼Æ¬ -->
            <div class="out_front">
                <img src="img/1.jpg" class="pic" />
            </div>
            <!--ï¿½ï¿½ï¿½ï¿½Í¼Æ¬ -->
            <div class="out_back">
                <img src="img/2.jpg" class="pic" />
            </div>
            <!--ï¿½ï¿½Í¼Æ¬ -->
            <div class="out_left">
                <img src="img/3.jpg" class="pic" />
            </div>
            <div class="out_right">
                <img src="img/4.jpg" class="pic" />
            </div>
            <div class="out_top">
                <img src="img/5.jpg" class="pic" />
            </div>
            <div class="out_bottom">
                <img src="img/6.jpg" class="pic" />
            </div>
            <!--Ğ¡ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ -->
            <span class="in_front">
                <img src="img/7.jpg" class="in_pic" />
            </span>
            <span class="in_back">
                <img src="img/8.jpg" class="in_pic" />
            </span>
            <span class="in_left">
                <img src="img/9.jpg" class="in_pic" />
            </span>
            <span class="in_right">
                <img src="img/10.jpg" class="in_pic" />
            </span>
            <span class="in_top">
                <img src="img/11.jpg" class="in_pic" />
            </span>
            <span class="in_bottom">
                <img src="img/12.jpg" class="in_pic" />
            </span>
        </div>
    </div>
    <!-- çˆ±å¿ƒç”»å¸ƒ -->
    <canvas id="pinkboard"></canvas>
    <canvas id="stars"></canvas>
    <script>
        var context;

        var arr = new Array();
        var starCount = 800;

        var rains = new Array();
        var rainCount = 20;

        //åˆå§‹åŒ–ç”»å¸ƒåŠcontext
        function init() {
            //è·å–canvas
            var stars = document.getElementById("stars");
            windowWidth = window.innerWidth; //å½“å‰çš„çª—å£çš„é«˜åº¦
            stars.width = windowWidth;
            stars.height = window.innerHeight;
            //è·å–context
            context = stars.getContext("2d");
        }

        //åˆ›å»ºä¸€ä¸ªæ˜Ÿæ˜Ÿå¯¹è±¡
        var Star = function () {
            this.x = windowWidth * Math.random();//æ¨ªåæ ‡
            this.y = 5000 * Math.random();//çºµåæ ‡
            this.text = "â¤";//æ–‡æœ¬
            this.color = "#ea80b0";//é¢œè‰²

            //äº§ç”Ÿéšæœºé¢œè‰²
            this.getColor = function () {

                var _r = Math.random();

                if (_r < 0.5) {
                    this.color = "#333";
                } else {
                    this.color = "#ea80b0";
                }

            }

            //åˆå§‹åŒ–
            this.init = function () {
                this.getColor();
            }
            //ç»˜åˆ¶
            this.draw = function () {
                context.fillStyle = this.color;
                context.fillText(this.text, this.x, this.y);
            }

        }


        //é¡µé¢åŠ è½½çš„æ—¶å€™
        window.onload = function () {

            init();
            //ç”»æ˜Ÿæ˜Ÿ
            for (var i = 0; i < starCount; i++) {
                var star = new Star();
                star.init();
                star.draw();
                arr.push(star);
            }

            //ç”»æµæ˜Ÿ
            for (var i = 0; i < rainCount; i++) {
                var rain = new MeteorRain();
                rain.init();
                rain.draw();
                rains.push(rain);
            }

            playStars();//ç»˜åˆ¶é—ªåŠ¨çš„æ˜Ÿæ˜Ÿ
            playRains();//ç»˜åˆ¶æµæ˜Ÿ


        }

        //æ˜Ÿæ˜Ÿé—ªèµ·æ¥
        function playStars() {
            for (var n = 0; n < starCount; n++) {
                arr[n].getColor();
                arr[n].draw();
            }

            setTimeout("playStars()", 100);
        }

        var MeteorRain = function () {
            this.x = -1;
            this.y = -1;
            this.length = -1;//é•¿åº¦
            this.angle = 30; //å€¾æ–œè§’åº¦
            this.width = -1;//å®½åº¦
            this.height = -1;//é«˜åº¦
            this.speed = 1;//é€Ÿåº¦
            this.offset_x = -1;//æ¨ªè½´ç§»åŠ¨åç§»é‡
            this.offset_y = -1;//çºµè½´ç§»åŠ¨åç§»é‡
            this.alpha = 1; //é€æ˜åº¦
            this.color1 = "#ea80b0";//æµæ˜Ÿçš„è‰²å½©
            this.color2 = "";  //æµæ˜Ÿçš„è‰²å½©

            this.init = function () //åˆå§‹åŒ–
            {
                this.getPos();
                this.alpha = 1;//é€æ˜åº¦
                this.getRandomColor();
                //æœ€å°é•¿åº¦ï¼Œæœ€å¤§é•¿åº¦
                var x = Math.random() * 80 + 150;
                this.length = Math.ceil(x);
                //                  x = Math.random()*10+30;
                this.angle = 30; //æµæ˜Ÿå€¾æ–œè§’
                x = Math.random() + 0.5;
                this.speed = Math.ceil(x); //æµæ˜Ÿçš„é€Ÿåº¦
                var cos = Math.cos(this.angle * 3.14 / 180);
                var sin = Math.sin(this.angle * 3.14 / 180);
                this.width = this.length * cos;  //æµæ˜Ÿæ‰€å å®½åº¦
                this.height = this.length * sin;//æµæ˜Ÿæ‰€å é«˜åº¦
                this.offset_x = this.speed * cos;
                this.offset_y = this.speed * sin;
            }


            this.getRandomColor = function () {
                var a = Math.ceil(255 - 240 * Math.random());
                //ä¸­æ®µé¢œè‰²
                this.color1 = "rgba(" + a + "," + a + "," + a + ",1)";
                //ç»“æŸé¢œè‰²
                this.color2 = "black";
            }

            this.countPos = function ()//
            {
                //å¾€å·¦ä¸‹ç§»åŠ¨,xå‡å°‘ï¼Œyå¢åŠ 
                this.x = this.x - this.offset_x;
                this.y = this.y + this.offset_y;
            }

            this.getPos = function () //
            {
                //æ¨ªåæ ‡200--1200

                this.x = Math.random() * window.innerWidth; //çª—å£é«˜åº¦
                //çºµåæ ‡å°äº600
                this.y = Math.random() * window.innerHeight;  //çª—å£å®½åº¦
            }
            this.draw = function () //ç»˜åˆ¶ä¸€ä¸ªæµæ˜Ÿçš„å‡½æ•°
            {
                context.save();
                context.beginPath();
                context.lineWidth = 1; //å®½åº¦
                context.globalAlpha = this.alpha; //è®¾ç½®é€æ˜åº¦
                //åˆ›å»ºæ¨ªå‘æ¸å˜é¢œè‰²,èµ·ç‚¹åæ ‡è‡³ç»ˆç‚¹åæ ‡
                var line = context.createLinearGradient(this.x, this.y,
                    this.x + this.width,
                    this.y - this.height);



                //åˆ†æ®µè®¾ç½®é¢œè‰²
                line.addColorStop(0, "#ea80b0");
                line.addColorStop(0.3, this.color1);
                line.addColorStop(0.6, this.color2);
                context.strokeStyle = line;
                //èµ·ç‚¹
                context.moveTo(this.x, this.y);
                //ç»ˆç‚¹
                context.lineTo(this.x + this.width, this.y - this.height);
                context.closePath();
                context.stroke();
                context.restore();
            }
            this.move = function () {
                //æ¸…ç©ºæµæ˜Ÿåƒç´ 
                var x = this.x + this.width - this.offset_x;
                var y = this.y - this.height;
                context.clearRect(x - 3, y - 3, this.offset_x + 5, this.offset_y + 5);
                //                  context.strokeStyle="red";
                //                  context.strokeRect(x,y-1,this.offset_x+1,this.offset_y+1);
                //é‡æ–°è®¡ç®—ä½ç½®ï¼Œå¾€å·¦ä¸‹ç§»åŠ¨
                this.countPos();
                //é€æ˜åº¦å¢åŠ 
                this.alpha -= 0.002;
                //é‡ç»˜
                this.draw();
            }

        }

        //ç»˜åˆ¶æµæ˜Ÿ
        function playRains() {

            for (var n = 0; n < rainCount; n++) {
                var rain = rains[n];
                rain.move();//ç§»åŠ¨
                if (rain.y > window.innerHeight) {//è¶…å‡ºç•Œé™åé‡æ¥
                    context.clearRect(rain.x, rain.y - rain.height, rain.width, rain.height);
                    rains[n] = new MeteorRain();
                    rains[n].init();
                }
            }
            setTimeout("playRains()", 2);
        }




        /*
         * Settings
         */
        var settings = {
            particles: {
                length: 500, // maximum amount of particles
                duration: 2, // particle duration in sec
                velocity: 100, // particle velocity in pixels/sec
                effect: -0.75, // play with this for a nice effect
                size: 20, // particle size in pixels
            },
        };

        /*
         * RequestAnimationFrame polyfill by Erik M?ller
         */
        (function () {
            var b = 0;
            var c = ["ms", "moz", "webkit", "o"];
            for (var a = 0; a < c.length && !window.requestAnimationFrame; ++a) { window.requestAnimationFrame = window[c[a] + "RequestAnimationFrame"]; window.cancelAnimationFrame = window[c[a] + "CancelAnimationFrame"] || window[c[a] + "CancelRequestAnimationFrame"] }
            if (!window.requestAnimationFrame) {
                window.requestAnimationFrame = function (h, e) { var d = new Date().getTime(); var f = Math.max(0, 16 - (d - b)); var g = window.setTimeout(function () { h(d + f) }, f); b = d + f; return g }
            } if (!window.cancelAnimationFrame) { window.cancelAnimationFrame = function (d) { clearTimeout(d) } }
        }());

        /*
         * Point class
         */
        var Point = (function () {
            function Point(x, y) {
                this.x = (typeof x !== 'undefined') ? x : 0;
                this.y = (typeof y !== 'undefined') ? y : 0;
            }
            Point.prototype.clone = function () {
                return new Point(this.x, this.y);
            };
            Point.prototype.length = function (length) {
                if (typeof length == 'undefined')
                    return Math.sqrt(this.x * this.x + this.y * this.y);
                this.normalize();
                this.x *= length;
                this.y *= length;
                return this;
            };
            Point.prototype.normalize = function () {
                var length = this.length();
                this.x /= length;
                this.y /= length;
                return this;
            };
            return Point;
        })();


        /*
         * Particle class
         */
        var Particle = (function () {
            function Particle() {
                this.position = new Point();
                this.velocity = new Point();
                this.acceleration = new Point();
                this.age = 0;
            }
            Particle.prototype.initialize = function (x, y, dx, dy) {
                this.position.x = x;
                this.position.y = y;
                this.velocity.x = dx;
                this.velocity.y = dy;
                this.acceleration.x = dx * settings.particles.effect;
                this.acceleration.y = dy * settings.particles.effect;
                this.age = 0;
            };
            Particle.prototype.update = function (deltaTime) {
                this.position.x += this.velocity.x * deltaTime;
                this.position.y += this.velocity.y * deltaTime;
                this.velocity.x += this.acceleration.x * deltaTime;
                this.velocity.y += this.acceleration.y * deltaTime;
                this.age += deltaTime;
            };
            Particle.prototype.draw = function (context, image) {
                function ease(t) {
                    return (--t) * t * t + 1;
                }
                var size = image.width * ease(this.age / settings.particles.duration);
                context.globalAlpha = 1 - this.age / settings.particles.duration;
                context.drawImage(image, this.position.x - size / 2, this.position.y - size / 2, size, size);
            };
            return Particle;
        })();

        /*
         * ParticlePool class
         */
        var ParticlePool = (function () {
            var particles,
                firstActive = 0,
                firstFree = 0,
                duration = settings.particles.duration;

            function ParticlePool(length) {
                // create and populate particle pool
                particles = new Array(length);
                for (var i = 0; i < particles.length; i++)
                    particles[i] = new Particle();
            }
            ParticlePool.prototype.add = function (x, y, dx, dy) {
                particles[firstFree].initialize(x, y, dx, dy);

                // handle circular queue
                firstFree++;
                if (firstFree == particles.length) firstFree = 0;
                if (firstActive == firstFree) firstActive++;
                if (firstActive == particles.length) firstActive = 0;
            };
            ParticlePool.prototype.update = function (deltaTime) {
                var i;

                // update active particles
                if (firstActive < firstFree) {
                    for (i = firstActive; i < firstFree; i++)
                        particles[i].update(deltaTime);
                }
                if (firstFree < firstActive) {
                    for (i = firstActive; i < particles.length; i++)
                        particles[i].update(deltaTime);
                    for (i = 0; i < firstFree; i++)
                        particles[i].update(deltaTime);
                }

                // remove inactive particles
                while (particles[firstActive].age >= duration && firstActive != firstFree) {
                    firstActive++;
                    if (firstActive == particles.length) firstActive = 0;
                }


            };
            ParticlePool.prototype.draw = function (context, image) {
                // draw active particles
                if (firstActive < firstFree) {
                    for (i = firstActive; i < firstFree; i++)
                        particles[i].draw(context, image);
                }
                if (firstFree < firstActive) {
                    for (i = firstActive; i < particles.length; i++)
                        particles[i].draw(context, image);
                    for (i = 0; i < firstFree; i++)
                        particles[i].draw(context, image);
                }
            };
            return ParticlePool;
        })();

        /*
         * Putting it all together
         */
        (function (canvas) {
            var context = canvas.getContext('2d'),
                particles = new ParticlePool(settings.particles.length),
                particleRate = settings.particles.length / settings.particles.duration, // particles/sec
                time;

            // get point on heart with -PI <= t <= PI
            function pointOnHeart(t) {
                return new Point(
                    160 * Math.pow(Math.sin(t), 3),
                    130 * Math.cos(t) - 50 * Math.cos(2 * t) - 20 * Math.cos(3 * t) - 10 * Math.cos(4 * t) + 25
                );
            }

            // creating the particle image using a dummy canvas
            var image = (function () {
                var canvas = document.createElement('canvas'),
                    context = canvas.getContext('2d');
                canvas.width = settings.particles.size;
                canvas.height = settings.particles.size;
                // helper function to create the path
                function to(t) {
                    var point = pointOnHeart(t);
                    point.x = settings.particles.size / 2 + point.x * settings.particles.size / 350;
                    point.y = settings.particles.size / 2 - point.y * settings.particles.size / 350;
                    return point;
                }
                // create the path
                context.beginPath();
                var t = -Math.PI;
                var point = to(t);
                context.moveTo(point.x, point.y);
                while (t < Math.PI) {
                    t += 0.01; // baby steps!
                    point = to(t);
                    context.lineTo(point.x, point.y);
                }
                context.closePath();
                // create the fill
                context.fillStyle = '#ea80b0';
                context.fill();
                // create the image
                var image = new Image();
                image.src = canvas.toDataURL();
                return image;
            })();

            // render that thing!
            function render() {
                // next animation frame
                requestAnimationFrame(render);

                // update time
                var newTime = new Date().getTime() / 1000,
                    deltaTime = newTime - (time || newTime);
                time = newTime;

                // clear canvas
                context.clearRect(0, 0, canvas.width, canvas.height);

                // create new particles
                var amount = particleRate * deltaTime;
                for (var i = 0; i < amount; i++) {
                    var pos = pointOnHeart(Math.PI - 2 * Math.PI * Math.random());
                    var dir = pos.clone().length(settings.particles.velocity);
                    particles.add(canvas.width / 2 + pos.x, canvas.height / 2 - pos.y, dir.x, -dir.y);
                }

                // update and draw particles
                particles.update(deltaTime);
                particles.draw(context, image);
            }

            // handle (re-)sizing of the canvas
            function onResize() {
                canvas.width = canvas.clientWidth;
                canvas.height = canvas.clientHeight;
            }
            window.onresize = onResize;

            // delay rendering bootstrap
            setTimeout(function () {
                onResize();
                render();
            }, 10);
        })(document.getElementById('pinkboard'));

    </script>
</body>
</html>